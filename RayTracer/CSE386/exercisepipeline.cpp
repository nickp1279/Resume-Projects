/****************************************************
 * 2016-2025 Eric Bachmann and Mike Zmuda
 * All Rights Reserved.
 * NOTICE:
 * Dissemination of this information or reproduction
 * of this material is prohibited unless prior written
 * permission is granted.
 ****************************************************/

#include <iostream>
#include "defs.h"
#include "utilities.h"
#include "io.h"

// Useful for multiplying a vector of vertices by a 4x4 matrix
vector<dvec4> transformVertices(const dmat4& M, const vector<dvec4>& verts) {
    vector<dvec4> result;
    for (const dvec4& v : verts) {
        result.push_back(M * v);
    }
    return result;
}

// Corners of 2x2x2 cube centered on origin. Homogeneous coordinates.
vector<dvec4> cubeVerts = {
    dvec4(-1, -1, -1, 1),
    dvec4(-1, 1,-1, 1),
    dvec4(1, 1,-1, 1),
    dvec4(1,-1,-1, 1),
    dvec4(-1,-1, 1, 1),
    dvec4(-1, 1, 1, 1),
    dvec4(1, 1, 1, 1),
    dvec4(1,-1, 1, 1),
};

// Camera configuration
dvec3 eyePos(3, 3, 3);
dvec3 lookAtPoint(0, 0, 0);
dvec3 up(0, 1, 0);

// Window size
double NX = 500;
double NY = 250;

// Viewport information
double VPllx = 0;
double VPlly = 0;
double VPwidth = NX;
double VPheight = NY;

// Orthographic camera parameters
double left = -4;
double right = +4;
double bottom = -3;
double top = +3;
double nearOrtho = 0;
double farOrtho = 7;

// Perspective camera parameters
double fovy = glm::radians(125.0);
double nearPersp = 0.1;
double farPersp = 5.0;
double aspectRatio = (double)NX / NY;

int main(int argc, char* argv[]) {


    // DEFINE THE RELEVANT MATRICES - FILL THIS SECTION IN
    // BASE ON THE CONSTANTS DEFINED ABOVE. USE glm::lookAt,
    // glm::ortho, glm::perspective, as needed.
    //dmat4 modelMat = T(2, 0, 3) * S(0.5f, 1.0f, 1.0f);
    //dmat4 viewMat = glm::lookAt(eyePos, lookAtPoint, up);
    //dmat4 projMatOrtho = glm::ortho(left, right, bottom, top, nearOrtho, farOrtho);
    //dmat4 projMatPersp = glm::perspective(fovy, aspectRatio, nearPersp, farPersp);
    //dmat4 viewportMat = T(VPllx + VPwidth / 2.0, VPlly + VPheight / 2.0, 0) *
    //    S(VPwidth / 2.0, VPheight / 2.0, 1);


    //// DON'T CHANGE THIS SECTION

    //cout << "THE MATRICES" << endl;
    //cout << "Modeling\n" << modelMat << endl;
    //cout << "Viewing\n" << viewMat << endl;
    //cout << "Orthographic projection\n" << projMatOrtho << endl;
    //cout << "Perspective projection\n" << projMatPersp << endl;
    //cout << "Viewport\n" << viewportMat << endl;

    //// Process vetices through the pipeline - FILL THIS SECTION IN

    //vector<dvec4> world = transformVertices(modelMat, cubeVerts);

    //vector<dvec4> eye = transformVertices(viewMat, world);

    //// For projection, use only orthographic OR projection matrix at
    //// one time.

    //vector<dvec4> projected = transformVertices(projMatOrtho, eye);
    ////vector<dvec4> projected = transformVertices(projMatPersp, eye);

    //// Perspective division done for you
    //vector<dvec4> ndc;
    //for (const dvec4& v : projected) {
    //    ndc.push_back(v / v.w);
    //}

    //vector<dvec4> window = transformVertices(viewportMat, ndc);

    //// DON'T CHANGE THIS SECTION

    //cout << "THE VERTICES AT EACH STAGE" << endl;
    //cout << "Original vertices\n" << cubeVerts << endl;
    //cout << "World coordinates\n" << world << endl;
    //cout << "Eye coordinates\n" << eye << endl;
    //cout << "Projected coordinates\n" << projected << endl;
    //cout << "Normalized device coordinates\n" << ndc << endl;
    //cout << "Window coordinates\n" << window << endl;

    //    // Translation T(1.0, 2.0, 3.0)
    //dmat4 T = translate(dmat4(1.0), dvec3(1.0, 2.0, 3.0));

    //// Scaling S(2.0, -2.0, 0.5)
    //dmat4 S = scale(dmat4(1.0), dvec3(2.0, -2.0, 0.5));

    //// Model = S * T
    //dmat4 M = S * T;

    //cout << "Modeling matrix (S*T):\n";
    //for (int i = 0; i < 4; ++i) {
    //    cout << "[ ";
    //    for (int j = 0; j < 4; ++j) {
    //        cout << M[i][j] << " ";
    //    }
    //    cout << "]\n";
    //}

    //dvec3 eye(2.0, 3.0, 4.0);
    //dvec3 center(-2.0, -3.0, 0.0);
    //dvec3 up(0.0, 1.0, 0.0);

    //dmat4 viewMat = glm::lookAt(eye, center, up);

    //cout << "Viewing matrix:\n";
    //for (int i = 0; i < 4; ++i) {
    //    cout << "[ ";
    //    for (int j = 0; j < 4; ++j) {
    //        cout << viewMat[i][j] << " ";
    //    }
    //    cout << "]\n";
    //}

    //dmat4 orthoMat = glm::ortho(-2.0, 2.0, -5.0, 5.0, 10.0, 20.0);

    //cout << "Orthographic Projection Matrix:\n";
    //for (int i = 0; i < 4; ++i) {
    //    cout << "[ ";
    //    for (int j = 0; j < 4; ++j) {
    //        cout << orthoMat[i][j] << " ";
    //    }
    //    cout << "]\n";
    //}

    dmat4 persp = glm::perspective(1.0, 0.5, 1.0, 10.0);

    cout << "Perspective Projection Matrix:\n";
    for (int i = 0; i < 4; ++i) {
        cout << "[ ";
        for (int j = 0; j < 4; ++j) {
            cout << persp[i][j] << " ";
        }
        cout << "]\n";
    }

    return 0;
}
/*
ORTHOGRAPHIC
=============================================
THE MATRICES
Modeling
[ [ 0.5 0.0 0.0 2.0 ]
[ 0.0 1.0 0.0 0.0 ]
[ 0.0 0.0 1.0 3.0 ]
[ 0.0 0.0 0.0 1.0 ]
]
Viewing
[ [ 0.7071067811865475 0.0 -0.7071067811865475 -0.0 ]
[ -0.40824829046386296 0.8164965809277259 -0.40824829046386296 -0.0 ]
[ 0.5773502691896257 0.5773502691896257 0.5773502691896257 -5.196152422706632 ]
[ 0.0 0.0 0.0 1.0 ]
]
Orthographic projection
[ [ 0.25 0.0 0.0 -0.0 ]
[ 0.0 0.3333333333333333 0.0 -0.0 ]
[ 0.0 0.0 -0.2857142857142857 -1.0 ]
[ 0.0 0.0 0.0 1.0 ]
]
Perspective projection
[ [ 0.2602835252758731 0.0 0.0 0.0 ]
[ 0.0 0.5205670505517462 0.0 0.0 ]
[ 0.0 0.0 -1.040816326530612 -0.2040816326530612 ]
[ 0.0 0.0 -1.0 0.0 ]
]
Viewport
[ [ 250.0 0.0 0.0 250.0 ]
[ 0.0 125.0 0.0 125.0 ]
[ 0.0 0.0 1.0 0.0 ]
[ 0.0 0.0 0.0 1.0 ]
]
THE VERTICES AT EACH STAGE
Original vertices
[
        [ -1.0 -1.0 -1.0 1.0 ]
        [ -1.0 -1.0 -1.0 1.0 ]
        [ -1.0 1.0 -1.0 1.0 ]
        [ 1.0 1.0 -1.0 1.0 ]
        [ 1.0 -1.0 -1.0 1.0 ]
        [ -1.0 -1.0 1.0 1.0 ]
        [ -1.0 1.0 1.0 1.0 ]
        [ 1.0 1.0 1.0 1.0 ]
        [ 1.0 -1.0 1.0 1.0 ]
]
World coordinates
[
        [ 1.5 -1.0 2.0 1.0 ]
        [ 1.5 -1.0 2.0 1.0 ]
        [ 1.5 1.0 2.0 1.0 ]
        [ 2.5 1.0 2.0 1.0 ]
        [ 2.5 -1.0 2.0 1.0 ]
        [ 1.5 -1.0 4.0 1.0 ]
        [ 1.5 1.0 4.0 1.0 ]
        [ 2.5 1.0 4.0 1.0 ]
        [ 2.5 -1.0 4.0 1.0 ]
]
Eye coordinates
[
        [ -0.35355339059327373 -2.2453655975512463 -3.7527767497325675 1.0 ]
        [ -0.35355339059327373 -2.2453655975512463 -3.7527767497325675 1.0 ]
        [ -0.35355339059327373 -0.6123724356957945 -2.598076211353316 1.0 ]
        [ 0.35355339059327373 -1.0206207261596574 -2.0207259421636907 1.0 ]
        [ 0.35355339059327373 -2.653613888015109 -3.175426480542942 1.0 ]
        [ -1.7677669529663687 -3.0618621784789726 -2.598076211353316 1.0 ]
        [ -1.7677669529663687 -1.4288690166235205 -1.4433756729740648 1.0 ]
        [ -1.0606601717798212 -1.8371173070873832 -0.8660254037844393 1.0 ]
        [ -1.0606601717798212 -3.470110468942835 -2.0207259421636907 1.0 ]
]
Projected coordinates
[
        [ -0.08838834764831843 -0.7484551991837487 0.07222192849501918 1.0 ]
        [ -0.08838834764831843 -0.7484551991837487 0.07222192849501918 1.0 ]
        [ -0.08838834764831843 -0.20412414523193148 -0.2576925110419097 1.0 ]
        [ 0.08838834764831843 -0.3402069087198858 -0.42264973081037416 1.0 ]
        [ 0.08838834764831843 -0.8845379626717029 -0.09273529127344515 1.0 ]
        [ -0.44194173824159216 -1.0206207261596574 -0.2576925110419097 1.0 ]
        [ -0.44194173824159216 -0.47628967220784013 -0.5876069505788386 1.0 ]
        [ -0.2651650429449553 -0.6123724356957944 -0.752564170347303 1.0 ]
        [ -0.2651650429449553 -1.1567034896476116 -0.42264973081037416 1.0 ]
]
Normalized device coordinates
[
        [ -0.08838834764831843 -0.7484551991837487 0.07222192849501918 1.0 ]
        [ -0.08838834764831843 -0.7484551991837487 0.07222192849501918 1.0 ]
        [ -0.08838834764831843 -0.20412414523193148 -0.2576925110419097 1.0 ]
        [ 0.08838834764831843 -0.3402069087198858 -0.42264973081037416 1.0 ]
        [ 0.08838834764831843 -0.8845379626717029 -0.09273529127344515 1.0 ]
        [ -0.44194173824159216 -1.0206207261596574 -0.2576925110419097 1.0 ]
        [ -0.44194173824159216 -0.47628967220784013 -0.5876069505788386 1.0 ]
        [ -0.2651650429449553 -0.6123724356957944 -0.752564170347303 1.0 ]
        [ -0.2651650429449553 -1.1567034896476116 -0.42264973081037416 1.0 ]
]
Window coordinates
[
        [ 227.90291308792038 31.44310010203141 0.07222192849501918 1.0 ]
        [ 227.90291308792038 31.44310010203141 0.07222192849501918 1.0 ]
        [ 227.90291308792038 99.48448184600856 -0.2576925110419097 1.0 ]
        [ 272.0970869120796 82.47413641001427 -0.42264973081037416 1.0 ]
        [ 272.0970869120796 14.432754666037141 -0.09273529127344515 1.0 ]
        [ 139.51456543960194 -2.577590769957169 -0.2576925110419097 1.0 ]
        [ 139.51456543960194 65.46379097401999 -0.5876069505788386 1.0 ]
        [ 183.70873926376117 48.453445538025704 -0.752564170347303 1.0 ]
        [ 183.70873926376117 -19.58793620595145 -0.42264973081037416 1.0 ]
]


PERSPECTIVE
=============================================
THE MATRICES
Modeling
[[ 0.5 0.0 0.0 2.0 ]
[0.0 1.0 0.0 0.0]
[0.0 0.0 1.0 3.0]
[0.0 0.0 0.0 1.0]
]
Viewing
[[ 0.7071067811865475 0.0 - 0.7071067811865475 - 0.0 ]
[-0.40824829046386296 0.8164965809277259 - 0.40824829046386296 - 0.0]
[0.5773502691896257 0.5773502691896257 0.5773502691896257 - 5.196152422706632]
[0.0 0.0 0.0 1.0]
]
Orthographic projection
[[ 0.25 0.0 0.0 - 0.0 ]
[0.0 0.3333333333333333 0.0 - 0.0]
[0.0 0.0 - 0.2857142857142857 - 1.0]
[0.0 0.0 0.0 1.0]
]
Perspective projection
[[ 0.2602835252758731 0.0 0.0 0.0 ]
[0.0 0.5205670505517462 0.0 0.0]
[0.0 0.0 - 1.040816326530612 - 0.2040816326530612]
[0.0 0.0 - 1.0 0.0]
]
Viewport
[[ 250.0 0.0 0.0 250.0 ]
[0.0 125.0 0.0 125.0]
[0.0 0.0 1.0 0.0]
[0.0 0.0 0.0 1.0]
]
THE VERTICES AT EACH STAGE
Original vertices
[
    [ -1.0 - 1.0 - 1.0 1.0 ]
        [-1.0 - 1.0 - 1.0 1.0]
        [-1.0 1.0 - 1.0 1.0]
        [1.0 1.0 - 1.0 1.0]
        [1.0 - 1.0 - 1.0 1.0]
        [-1.0 - 1.0 1.0 1.0]
        [-1.0 1.0 1.0 1.0]
        [1.0 1.0 1.0 1.0]
        [1.0 - 1.0 1.0 1.0]
]
World coordinates
[
    [ 1.5 - 1.0 2.0 1.0 ]
        [1.5 - 1.0 2.0 1.0]
        [1.5 1.0 2.0 1.0]
        [2.5 1.0 2.0 1.0]
        [2.5 - 1.0 2.0 1.0]
        [1.5 - 1.0 4.0 1.0]
        [1.5 1.0 4.0 1.0]
        [2.5 1.0 4.0 1.0]
        [2.5 - 1.0 4.0 1.0]
]
Eye coordinates
[
    [ -0.35355339059327373 - 2.2453655975512463 - 3.7527767497325675 1.0 ]
        [-0.35355339059327373 - 2.2453655975512463 - 3.7527767497325675 1.0]
        [-0.35355339059327373 - 0.6123724356957945 - 2.598076211353316 1.0]
        [0.35355339059327373 - 1.0206207261596574 - 2.0207259421636907 1.0]
        [0.35355339059327373 - 2.653613888015109 - 3.175426480542942 1.0]
        [-1.7677669529663687 - 3.0618621784789726 - 2.598076211353316 1.0]
        [-1.7677669529663687 - 1.4288690166235205 - 1.4433756729740648 1.0]
        [-1.0606601717798212 - 1.8371173070873832 - 0.8660254037844393 1.0]
        [-1.0606601717798212 - 3.470110468942835 - 2.0207259421636907 1.0]
]
Projected coordinates
[
    [ -0.092024122876855 - 1.1688633465276115 3.70186967829308 3.7527767497325675 ]
        [-0.092024122876855 - 1.1688633465276115 3.70186967829308 3.7527767497325675]
        [-0.092024122876855 - 0.3187809126893486 2.5000385056942673 2.598076211353316]
        [0.092024122876855 - 0.5313015211489143 1.8991229193948616 2.0207259421636907]
        [0.092024122876855 - 1.3813839549871771 3.100954091993674 3.175426480542942]
        [-0.46012061438427504 - 1.5939045634467432 2.5000385056942673 2.598076211353316]
        [-0.46012061438427504 - 0.7438221296084802 1.2982073330954549 1.4433756729740648]
        [-0.276072368630565 - 0.9563427380680457 0.6972917467960489 0.8660254037844393]
        [-0.276072368630565 - 1.8064251719063085 1.8991229193948616 2.0207259421636907]
]
Normalized device coordinates
[
    [ -0.02452160866841143 - 0.31146626204474 0.9864348255080414 1.0 ]
        [-0.02452160866841143 - 0.31146626204474 0.9864348255080414 1.0]
        [-0.03542010140992762 - 0.12269883050247334 0.96226526949801 1.0]
        [0.04554013038419265 - 0.26292606536244273 0.939822110345838 1.0]
        [0.028980082971758962 - 0.4350231263269508 0.9765472798675741 1.0]
        [-0.17710050704963812 - 0.6134941525123667 0.96226526949801 1.0]
        [-0.31878091268934855 - 0.515335088110388 0.8994244238719282 1.0]
        [-0.3187809126893484 - 1.1042894745222591 0.8051631554328058 1.0]
        [-0.13662039115257793 - 0.8939486222323053 0.939822110345838 1.0]
]
Window coordinates
[
    [ 243.86959783289714 86.0667172444075 0.9864348255080414 1.0 ]
        [243.86959783289714 86.0667172444075 0.9864348255080414 1.0]
        [241.1449746475181 109.66264618719083 0.96226526949801 1.0]
        [261.3850325960482 92.13424182969466 0.939822110345838 1.0]
        [257.24502074293974 70.62210920913115 0.9765472798675741 1.0]
        [205.7248732375905 48.31323093595417 0.96226526949801 1.0]
        [170.30477182766288 60.5831139862015 0.8994244238719282 1.0]
        [170.3047718276629 - 13.036184315282384 0.8051631554328058 1.0]
        [215.84490221185553 13.256422220961838 0.939822110345838 1.0]
]
*/
